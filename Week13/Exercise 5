#!/usr/bin/env python
# coding: utf-8

# In[1]:


# main.py
from fastapi import FastAPI
from routes import users
import time
import json
from pathlib import Path

app = FastAPI(
    title="User Management API",
    description="FastAPI backend for managing users",
    version="1.0.0",
)

app.include_router(users.router, prefix="/users", tags=["Users"])

START = time.time()
DB_FILE = Path(__file__).resolve().parent / "users.txt"

@app.get("/")
def health_check():
    return {"status": "healthy", "message": "API is running"}

@app.get("/health")
def detailed_health():
    uptime = round(time.time() - START, 2)
    db_ok = True
    count = 0
    try:
        raw = DB_FILE.read_text(encoding="utf-8").strip() or "[]"
        count = len(json.loads(raw))
    except Exception:
        db_ok = False

    return {
        "status": "healthy" if db_ok else "degraded",
        "uptime_seconds": uptime,
        "db_ok": db_ok,
        "users_count": count,
        "version": app.version,
    }


# In[ ]:





# In[ ]:




